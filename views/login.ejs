<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title><%= title || "책모아" %></title>
</head>
<body>
  <div class="login-wrapper">
    <h1>로그인</h1>
    <% if (typeof errorMsg !== 'undefined' && errorMsg) { %>
      <div class="error-msg"><%= errorMsg %></div>
    <% } %>
    <form id="loginForm" action="/auth/login" method="POST">
      <input
        type="text"
        name="user_id"
        placeholder="아이디"
        required
        id="user_id"
        value="<%= typeof user_id !== 'undefined' ? user_id : '' %>"
      />
      <input
        type="password"
        name="password"
        placeholder="비밀번호"
        required
      />
      <button type="submit">로그인</button>
    </form>
  </div>
</body>
</html>

<script>
  const loginForm = document.getElementById("loginForm");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(loginForm);
    const user_id = formData.get("user_id");
    const password = formData.get("password");

    try {
      const res = await fetch("/auth/login", {
        method: "POST",
        credentials: "include",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ user_id, password }),
      });

      const text = await res.text();
      let data;

      try {
        data = JSON.parse(text);
      } catch {
        console.error("응답이 JSON이 아님:", text);
        alert("서버 에러 또는 응답 형식 오류");
        return;
      }

      if (res.ok) {
        alert(data.message);
        window.location.href = "/";
      } else {
        alert("로그인 실패: " + (data.error || "에러"));
      }
    } catch (err) {
      console.error("로그인 중 에러:", err);
      alert("서버 통신 에러");
    }
  });
</script>

<style>
  .login-wrapper {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 60px 80px;
    width: 400px;
    box-sizing: border-box;
    text-align: center;
    z-index: 1;
    margin-top: 70px;
  }

  .login-wrapper h1 {
    font-size: 32px;
    margin-bottom: 40px;
    font-weight: 700;
  }

  .login-wrapper form input {
    width: 100%;
    padding: 15px;
    margin-bottom: 25px;
    border: 1px solid #000;
    border-radius: 20px;
    box-shadow: 0 4px 4px rgba(0,0,0,0.25);
    font-size: 16px;
    font-weight: 600;
    box-sizing: border-box;
  }

  .login-wrapper form button {
    width: 100%;
    padding: 15px 0;
    background: #FFC1A9;
    border: 1px solid #000;
    border-radius: 15px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
  }

  .login-wrapper form button:hover {
    background: #FFA07A;
  }

  .error-msg {
    color: red;
    margin-bottom: 15px;
    font-weight: 700;
  }
</style>
