<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
</head>
<body>
  <div style="display: flex; flex-direction: column; align-items: center;">
    <h1 style="font-size: 2em; margin-bottom: 30px; text-align: center;">ììœ ê²Œì‹œíŒ</h1>

    <div style="width: 700px; background-color: white; border-radius: 10px; padding: 20px; margin-bottom: 30px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center;">
      <p style="margin: 0; font-weight: bold;">ğŸ“„ <span id="post-title">ê²Œì‹œê¸€ ì œëª©</span></p>
      <p style="font-size: 0.9em; color: #555;">ì‘ì„±ì: <span id="post-author">ì‘ì„±ì</span> | ì‘ì„±ì¼: <span id="post-date">ë‚ ì§œ</span> | ì¡°íšŒìˆ˜: <span id="post-views">0</span></p>
    </div>

    <div id="post-container" style="width: 700px; background-color: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
      ë¡œë”© ì¤‘...
    </div>

    <div style="width: 700px; background-color: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
      <h3 style="margin-top: 0;">ëŒ“ê¸€</h3>
      <ul id="comment-list" style="list-style: none; padding: 0;"></ul>
      <form id="comment-form" style="margin-top: 20px;">
        <textarea name="content" rows="3" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
        <div style="text-align: right; margin-top: 10px;">
          <button type="submit" style="padding: 6px 20px; background-color: #f0e5d8; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">ë“±ë¡</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // í˜„ì¬ URLì—ì„œ postIdë¥¼ ì¶”ì¶œ
    const pathParts = window.location.pathname.split('/');
    const postId = pathParts[pathParts.length - 1]; // ë§ˆì§€ë§‰ segmentê°€ postId

    if (!postId || isNaN(postId)) {
      document.getElementById('post-container').innerHTML = 'ì˜ëª»ëœ ê²Œì‹œê¸€ ì ‘ê·¼ì…ë‹ˆë‹¤.';
    } else {
      async function fetchPost() {
        const res = await fetch(`/posts/${postId}`);
        if (!res.ok) {
          document.getElementById('post-container').innerHTML = 'ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }

        const post = await res.json();
        document.getElementById('post-title').textContent = post.title;
        document.getElementById('post-author').textContent = post.author_nickname ?? 'ì•Œ ìˆ˜ ì—†ìŒ';
        document.getElementById('post-date').textContent = new Date(post.created_at).toLocaleString();
        document.getElementById('post-views').textContent = post.views ?? 0;
        document.getElementById('post-container').innerHTML = `<p>${post.content}</p>`;
      }

      async function fetchComments() {
        const res = await fetch(`/comments/${postId}`);
        const comments = await res.json();
        const list = document.getElementById('comment-list');
        list.innerHTML = '';
        comments.forEach(c => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${c.author}</strong> (${new Date(c.created_at).toLocaleString()}): ${c.content}`;
          list.appendChild(li);
        });
      }

      document.getElementById('comment-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const comment = {
          content: form.content.value
        };
        const res = await fetch(`/comments/${postId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(comment)
        });
        if (res.ok) {
          form.reset();
          fetchComments();
        } else {
          alert('ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨');
        }
      });

      fetchPost();
      fetchComments();
    }
  </script>
</body>
</html>