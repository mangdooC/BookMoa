<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë§ˆì´ í˜ì´ì§€</title>
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  
  <script src="/mypagejs/menu.js"></script>
  <script src="/mypagejs/userinfo.js"></script>
  <script src="/mypagejs/favorite.js"></script>
  <script src="/mypagejs/userbookreview.js"></script>
  <script src="/mypagejs/userLibrary.js"></script>
  <script src="/mypagejs/usercommunity.js"></script>
  <script src="/mypagejs/preferred.js"></script>

  <style>
    .section { display: none; }
    .section.active { display: block; }

    /* ë©”ë‰´ë°” */
    .main-menu {
        display: flex;
        justify-content: center;
        gap: 8px;
        background-color: transparent;
        margin-bottom: 20px;
        margin-right: 10px;
    }

    .main-menu a {
        padding: 10px 20px;
        border-radius: 12px;
        background-color: #FFC1A9;
        text-decoration: none;
        color: black;
        font-weight: 500;
        font-size: 14px;
        box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
        float: left;
        width: 250px;
        height: 520px;
        background: #fff;
        border-right: 1px solid #ccc;
        padding: 20px;
        box-sizing: border-box;
        margin-right: 8px;
        margin-left: 25px;
        border-radius: 10px;
    }

    .sidebar .profile {
        text-align: center;
        margin-bottom: 15px;
    }

    .sidebar .profile img {
        width: 130px;
        height: 130px;
        object-fit: cover;
        border-radius: 50%;
        cursor: pointer;
        margin-top: 30px;
    }

    .sidebar .profile #nicknameDisplay {
        margin-top: 10px;
        font-weight: 700;
        font-size: 16px;
    }

    .sidebar .menu button {
        width: 100%;
        padding: 12px 10px;
        margin-bottom: 10px;
        font-weight: 700;
        font-size: 16px;
        border: none;
        background: #FFC1A9;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        white-space: nowrap;
    }

    .sidebar .menu button.active {
    background-color: #ff986f;
    color: white;
    }

    /* ë©”ì¸ ì½˜í…ì¸  */
    .main {
        overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ */
        max-height: 600px; /* í™”ë©´ ë†’ì´ ë‚´ì—ì„œ ìµœëŒ€ ë†’ì´ ì œí•œ */
        max-width: 1100px;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        padding: 20px 30px 70px 40px;
        margin: 0 auto; /* í™”ë©´ ê°€ìš´ë° ì •ë ¬ */
    }

    .section {
        display: none;
    }

    .section.active {
        display: block;
    }

    h2 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 30px;
    }

    /* í¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 8px;
    }

    .form-group input[type="text"],
    .form-group input[type="password"] {
        width: 100%;
        height: 50px;
        border: 1px solid #000;
        border-radius: 20px;
        padding: 0 20px;
        font-size: 18px;
        box-sizing: border-box;
        box-shadow: 0 4px 4px rgba(0,0,0,0.25);
    }

    /* ì£¼ì†Œ ê²€ìƒ‰ */
    .address-search-wrapper {
        display: flex;
        align-items: center;
    }

    .address-search-wrapper input[readonly] {
        flex-grow: 1;
        cursor: pointer;
    }

    .address-search-wrapper button {
        margin-left: 15px;
        padding: 10px 20px;
        font-weight: 700;
        font-size: 14px;
        border: none;
        background: #FFC1A9;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 4px 4px rgba(0,0,0,0.25);
        white-space: nowrap;
    }

    .address-search-wrapper button:hover {
        background: #ff986f;
        color: white;
    }

    .save-btn {
        padding: 15px 30px;
        font-weight: 700;
        font-size: 15px;
        background: #FFC1A9;
        border: 1px solid #000;
        border-radius: 15px;
        cursor: pointer;
        margin-top: 30px;
        display: inline-block;
        box-shadow: 0 4px 4px rgba(0,0,0,0.25);
    }

    /* ì¦ê²¨ì°¾ê¸° ë„ì„œê´€ ë¦¬ìŠ¤íŠ¸ */
    #favoritesList {
        list-style: none;
        padding-left: 0;
        margin-bottom: 20px;
    }

    #favoritesList li {
        padding: 10px 15px;
        border: 1px solid #000;
        border-radius: 10px;
        margin-bottom: 8px;
        background: #fff;
        font-weight: 700;
        font-size: 18px;
    }

    /* ì¦ê²¨ì°¾ê¸° ì¶”ê°€ input + button */
    .form-inline {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }

    .form-inline input[type="text"] {
        flex-grow: 1;
        height: 45px;
        border-radius: 15px;
        padding: 0 15px;
        border: 1px solid #ccc;
    }

    .form-inline button {
        white-space: nowrap;
        width: 70px;
        height: 45px;
        font-weight: 700;
        border-radius: 15px;
        background: #FFC1A9;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 4px rgba(0,0,0,0.25);
    }

    .menu button.active {
        background-color: #ff986f;
        color: white;
    }
  </style>
</head>
<body>
<div class="sidebar">
  <div class="profile">
    <form id="profileForm" action="/mypage/upload-profile-image" method="POST" enctype="multipart/form-data">
    <input type="file" id="profileImage" name="profileImage" accept="image/*" style="display:none;" />
    <img
        id="profilePreview"
        src="<%= user.profileImage || '/mypage/images/default.jpg' %>"
        alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
        style="width: 130px; height: 130px; object-fit: cover; border-radius: 50%; cursor: pointer;"
        title="í´ë¦­í•´ì„œ í”„ë¡œí•„ ì´ë¯¸ì§€ ì„ íƒ"
    />
    </form>
    <p id="nicknameDisplay" style="margin-top: 10px; font-weight: bold; font-size: 23px;">
      <%= user.nickname || 'ë‹‰ë„¤ì„ ì—†ìŒ' %>
    </p>
  </div>

    <div class="menu">
        <button type="button" onclick="showSection('info')">ë‚´ ì •ë³´ ìˆ˜ì •</button>
        <button type="button" onclick="showSection('preferredAreaSection')">ì„ í˜¸ì§€ì—­</button>
        <button type="button" onclick="showSection('favorites')">ì¦ê²¨ì°¾ëŠ” ë„ì„œê´€</button>
        <button type="button" onclick="showSection('posts')">ì‘ì„±í•œ ê¸€/ëŒ“ê¸€</button>
    </div>
</div>

  <div class="main">
    <!-- ë‚´ ì •ë³´ ìˆ˜ì • -->
    <div id="info" class="section">
        <form id="updateForm">
            <div>
            <label for="password">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</label>
            <input type="password" id="password" name="password" />
            </div>
            <div>
            <label for="nickname">ë‹‰ë„¤ì„</label>
            <input type="text" id="nickname" name="nickname" value="<%= user.nickname %>" />
            </div>
            <div>
            <label for="address">ì£¼ì†Œ</label>
            <input type="text" id="address" name="address" value="<%= user.address %>" />
            </div>
            <button type="submit" id="saveInfoBtn">ì €ì¥</button>
        </form>
        </div>

    <!-- ì„ í˜¸ì§€ì—­ -->
    <section id="preferredAreaSection" class="section">
    <h2>ì„ í˜¸ì§€ì—­</h2>

    <% ['region_level1', 'region_level2', 'region_level3'].forEach(function(addr, idx) { %>
    <div class="form-group">
        <label for="<%= addr %>">ì„ í˜¸ì§€ì—­ <%= idx + 1 %></label>
        <div class="address-search-wrapper">
        <input
            type="text"
            id="<%= addr %>"
            name="<%= addr %>"
            placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            readonly
            value="<%= preferred_areas[idx] ? preferred_areas[idx].region_name : '' %>"
        />
        <button type="button" onclick="searchPreferredAddress('<%= addr %>')">ì£¼ì†Œ ê²€ìƒ‰</button>
        </div>
    </div>
    <% }); %>

    <button class="save-btn" type="button" onclick="savePreferredAddresses()">ì €ì¥</button>
    </section>

      <button class="save-btn" type="button" onclick="savePreferredAddresses()">ì €ì¥</button>
    </section>

    <!-- ì¦ê²¨ì°¾ëŠ” ë„ì„œê´€ -->
    <section id="favorites" class="section">
    <h2>ì¦ê²¨ì°¾ëŠ” ë„ì„œê´€</h2>
    <ul id="favoritesList">
        <% if (favorites && favorites.length > 0) { %>
        <% favorites.forEach(function(lib) { %>
            <li data-library-id="<%= lib.library_id %>">
            <%= lib.name %> - <%= lib.address %>
            <button class="removeFavoriteBtn" data-library-id="<%= lib.library_id %>">ì‚­ì œ</button>
            </li>
        <% }); %>
        <% } else { %>
        <li>ì¦ê²¨ì°¾ëŠ” ë„ì„œê´€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        <% } %>
    </ul>

    <div class="form-group form-inline">
        <input type="text" id="newFavoriteInput" placeholder="ë„ì„œê´€ ì´ë¦„ ì…ë ¥" />
        <button id="addFavoriteBtn" type="button">ì¶”ê°€</button>
    </div>
    </section>

    <!-- ì‘ì„±í•œ ê¸€ -->
    <section id="posts" class="section">
      <h2>ì‘ì„±í•œ ê¸€</h2>

    <div class="post-category">
        <h3>ğŸ“š ë„ì„œ ë¦¬ë·°</h3>
        <ul id="bookReviewList">
            <% if(user.bookReviews && user.bookReviews.length > 0) { %>
            <% user.bookReviews.forEach(function(review) { %>
                <li>
                <a href="/bookReview/post/<%= review.review_id %>"><%= review.title %></a>
                - í‰ì : <%= review.rating %>ì 
                <form action="/userBookReview/<%= review.review_id %>/delete" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');">ì‚­ì œ</button>
                </form>
                </li>
            <% }); %>
            <% } else { %>
            <li>ì‘ì„±í•œ ë„ì„œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
            <% } %>
        </ul>
    </div>


    <div class="post-category">
        <h3>ğŸ›ï¸ ë„ì„œê´€ ë¦¬ë·°</h3>
        <ul id="libraryReviewList">
            <% if(user.libraryReviews && user.libraryReviews.length > 0) { %>
            <% user.libraryReviews.forEach(function(review) { %>
                <li>
                <a href="/libraryReview/<%= review.review_id %>">
                    <%= review.library_name %> í›„ê¸°
                </a>
                </li>
            <% }); %>
            <% } else { %>
            <li>ì‘ì„±í•œ ë„ì„œê´€ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
            <% } %>
        </ul>
    </div>


    <div class="post-category">
        <h3>ğŸ—£ï¸ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€</h3>
        <ul id="communityPostList">
            <% if (user.communityPosts && user.communityPosts.length > 0) { %>
            <% user.communityPosts.forEach(post => { %>
            <li>
                <a href="/community/communityList/post/<%= post.id %>" class="post-title"><%= post.title %></a><br />
                <small><%= new Date(post.created_at).toLocaleString() %></small><br />
                <form method="POST" action="/community/communityList/post/<%= post.id %>/delete" style="display:inline;">
                <button type="submit" onclick="return confirm('ê¸€ì„ ì‚­ì œí•©ë‹ˆê¹Œ?');">ì‚­ì œ</button>
                </form>
                <a href="/community/post/<%= post.id %>/edit"><button>ìˆ˜ì •</button></a>
            </li>
            <% }) %>
        </ul>
    </div>

    <div class="post-category">
        <h3>ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€</h3>
        <ul id="communityCommentList">
            <% if (user.communityComments && user.communityComments.length > 0) { %>
            <% user.communityComments.forEach(comment => { %>
                <li>
                <p><%= comment.content %></p>
                <small><%= new Date(comment.created_at).toLocaleString() %></small><br />
                <button class="delete-comment-btn" data-comment-id="<%= comment.id %>">[ì‚­ì œ]</button>
                <a href="/community/communityList/comment/<%= comment.id %>/edit"><button>[ìˆ˜ì •]</button></a>
                </li>
            <% }) %>
            <% } else { %>
            <li>ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
            <% } %>
        </ul>
    </div>
    </section>
  </div>
</body>
</html>

