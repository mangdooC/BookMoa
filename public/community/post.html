<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
</head>
<body>
  <h1>ğŸ“„ ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</h1>
  <div id="post-container">
    ë¡œë”© ì¤‘...
  </div>

    <h3>ëŒ“ê¸€</h3>
        <ul id="comment-list"></ul>
            <form id="comment-form">
                <input type="text" name="author" placeholder="ì‘ì„±ì" required>
                <br>
                <textarea name="content" rows="3" cols="40" placeholder="ëŒ“ê¸€ ì…ë ¥" required></textarea>
                <br>
                <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
            </form>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');

    if (!postId) {
      document.getElementById('post-container').innerHTML = 'ì˜ëª»ëœ ê²Œì‹œê¸€ ì ‘ê·¼ì…ë‹ˆë‹¤.';
    } else {
      async function fetchPost() {
        const res = await fetch(`/posts/${postId}`);
        if (!res.ok) {
          document.getElementById('post-container').innerHTML = 'ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }

        const post = await res.json();
        document.getElementById('post-container').innerHTML = `
          <h2>${post.title}</h2>
          <p><small>ì‘ì„±ì: ${post.author ?? 'ì•Œ ìˆ˜ ì—†ìŒ'}</small></p>
          <p><small>ì‘ì„±ì¼: ${new Date(post.createdAt).toLocaleString()}</small></p>
          <p>${post.content}</p>
          <a href="/community/communityList.html">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        `;
      }

      async function fetchComments() {
        const res = await fetch(`/comments/${postId}`);
        const comments = await res.json();
        const list = document.getElementById('comment-list');
        list.innerHTML = '';
        comments.forEach(c => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${c.author}</strong> (${new Date(c.createdAt).toLocaleString()}): ${c.content}`;
          list.appendChild(li);
        });
      }

      document.getElementById('comment-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const comment = {
          author: 'ì•Œ ìˆ˜ ì—†ìŒ', //ë°ë²  ì—°ê²° í›„ ì´ë¶€ë¶„ ìˆ˜ì •í•´ì•¼ëŒ
          content: form.content.value
        };
        const res = await fetch(`/comments/${postId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(comment)
        });
        if (res.ok) {
          form.reset();
          fetchComments();
        } else {
          alert('ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨');
        }
      });

      fetchPost();
      fetchComments();
    }
  </script>
</body>
</html>